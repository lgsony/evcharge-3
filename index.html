<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>EV Charge Log Pro</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root{
  --bg:#000;
  --card:#1c1c1e;
  --text:#fff;
  --tesla-red:#E31937;
  --gray:#333;
  --border:#2c2c2e;
  --focus:#007AFF;
}

body{
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, sans-serif;
  background:var(--bg);
  color:var(--text);
  padding-bottom:120px; /* ÈÅøÂºÄÂ∫ïÈÉ®bar */
}

.c{
  max-width:600px;
  margin:0 auto;
  padding:0 16px 40px;
}

header{
  padding:32px 0 20px;
  text-align:center;
  font-size:34px;
  font-weight:800;
  color:var(--tesla-red);
}

.card{
  background:var(--card);
  border-radius:22px;
  margin:22px 0;
  border:1px solid var(--border);
  box-shadow:0 8px 32px rgba(227,25,55,0.12);
}
.section{
  padding:22px 20px 26px;
}
.section:not(:last-child){
  border-bottom:1px solid var(--border);
}

/* Inputs */
input, select{
  width:100%;
  padding:18px;
  height:58px;
  border:none;
  border-radius:16px;
  background:#2c2c2e;
  color:white;
  font-size:18px;
  box-sizing:border-box;
}
input:focus, select:focus{
  background:#3a3a3c;
  outline:none;
  box-shadow:0 0 0 3px var(--focus);
}

/* iOS date */
input[type="date"]{
  -webkit-appearance:none;
  appearance:none;
  color:white;
  padding:0 18px !important;
  height:58px !important;
  line-height:58px !important;
}
input[type="date"]::-webkit-calendar-picker-indicator{
  filter:invert(1);
  opacity:.7;
}

#location{
  font-weight:600;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23888888' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat:no-repeat;
  background-position:right 18px center;
}
#location option[data-divider]{
  height:1px;
  background:#444;
  margin:8px 16px;
}

.row{
  display:flex;
  gap:14px;
}
.row > input{
  flex:1;
}

/* Rate quick buttons */
.quick-btns{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
}
.qb{
  padding:12px 22px;
  background:var(--gray);
  color:white;
  border-radius:40px;
  border:1px solid #555;
  cursor:pointer;
}

/* Main buttons */
.btn{
  width:100%;
  background:linear-gradient(180deg,#ff2a47,#e31937);
  color:white;
  padding:20px;
  border-radius:18px;
  border:none;
  margin-top:18px;
  font-size:20px;
  font-weight:700;
  cursor:pointer;
}
.btn.secondary{
  background:#333;
  display:none;
}

/* Table */
.table-wrapper{
  overflow:auto;
  border-radius:16px;
}
table{
  width:100%;
  min-width:880px;
}
th,td{
  padding:16px 10px;
  text-align:center;
  border-bottom:1px solid var(--border);
  border-right:1px solid var(--border);
}
th:last-child,td:last-child{ border-right:none; }
th{ background:#252525; color:#aaa; }
.empty-row{
  padding:16px;
  color:#777;
}

/* Icons */
.action{
  font-size:18px;
  cursor:pointer;
  opacity:.7;
  margin:0 4px;
}
.action:hover{ opacity:1; }

/* Location list */
.loc-row{
  display:flex;
  justify-content:space-between;
  padding:10px 0;
  border-bottom:1px solid var(--border);
}
.loc-actions span{
  margin-left:10px;
  cursor:pointer;
  opacity:.75;
}

/* Monthly summary */
.summary-row{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid var(--border);
}
.summary-month{ font-weight:600; }
.summary-values{ text-align:right; }

/* Bottom bar */
.bottom-bar {
    width: 100%;
    padding: 20px 16px 40px;
    background: transparent;
    display: flex;
    justify-content: center;
    gap: 14px;
    margin-top: 20px;
}

.bottom-btn {
    flex: 1;
    max-width: 200px;
    padding: 14px 0;
    border-radius: 14px;
    background: #222;
    color: #fff;
    text-align: center;
    font-size: 15px;
    border: 1px solid #333;
}
.bottom-btn:active {
    background: #333;
}




.version{
  text-align:center;
  color:#555;
  margin-top:40px;
  font-size:11px;
}
</style>
</head>

<body>

<div class="c">
  <header>EV Charge Log Pro</header>

  <!-- FORM -->
  <div class="card">
    <div class="section">
      <input type="date" id="date">
    </div>

    <div class="section">
      <div class="row">
        <!-- Start / End: text + inputmode=numericÔºåËá™Âä®Ë∑≥ -->
        <input id="start" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Start %" maxlength="3">
        <input id="end"   type="text" inputmode="numeric" pattern="[0-9]*" placeholder="End %"   maxlength="3">
      </div>
    </div>

    <div class="section">
      <!-- Êñ∞Â¢û ODO -->
      <input id="odo" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="ODO (km)">
    </div>

    <div class="section">
      <select id="location">
        <option value="">Select Location</option>
        <option value="__ADD__">+ Add New Location</option>
        <option data-divider></option>
      </select>
    </div>

    <div class="section">
      <div class="quick-btns">
        <button class="qb" onclick="setRate(0.84)">0.84</button>
        <button class="qb" onclick="setRate(1.00)">1.00</button>
        <button class="qb" onclick="setRate(1.30)">1.30</button>
        <button class="qb" onclick="setRate(1.50)">1.50</button>
        <button class="qb" onclick="setRate(1.80)">1.80</button>
        <button class="qb" onclick="setRate(0)">Free</button>
      </div>
    </div>

    <div class="section">
      <div class="row">
        <!-- Rate / Cost: decimal keypad -->
        <input id="rate" type="text" inputmode="decimal" pattern="[0-9.]*" placeholder="Rate (RM/kWh)">
        <input id="cost" type="text" inputmode="decimal" pattern="[0-9.]*" placeholder="Cost (RM)">
      </div>
    </div>

    <div class="section">
      <button class="btn" id="main-btn" onclick="submitForm()">Add Record</button>
      <button class="btn secondary" id="cancel-btn" onclick="cancelEdit()">Cancel Edit</button>
    </div>
  </div>

  <!-- MONTHLY SUMMARY -->
  <div class="card">
    <div class="section">
      <div class="summary-title">Monthly Summary (60 kWh pack)</div>
      <div id="month-summary"></div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="card">
    <div class="section" style="padding:0;">
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Start</th>
              <th>End</th>
              <th>Used kWh</th>
              <th>KM</th>
              <th>Location</th>
              <th>Rate</th>
              <th>Cost</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- LOCATION MANAGEMENT -->
  <div class="card">
    <div class="section">
      <div style="font-weight:600;margin-bottom:8px;">Saved Locations</div>
      <div id="loc-list"></div>
      <button class="btn secondary" onclick="addLocationManually()">+ Add Location</button>
    </div>
  </div>

  <div class="version" id="version"></div>
</div>

<!-- BOTTOM BAR -->
<div class="bottom-bar">
    <div class="bottom-btn" onclick="importCSV()">Import CSV</div>
    <div class="bottom-btn" onclick="exportCSV()">Export CSV</div>
</div>

<input type="file" id="importFile" accept=".csv" style="display:none" onchange="importAll(this)">

<script>
/* ==== ÈÖçÁΩÆÔºöÁîµÊ±†ÂÆπÈáèÔºàkWhÔºâ ==== */
const BATTERY_KWH = 60; // Model Y RWDÔºåÂÅáËÆæ 60kWh

/* ==== STORAGE KEYS ==== */
const KEYS={
  records:'evRecords2025',
  locations:'evLocations2025',
  rates:'evRateMemory2025'
};

let records=JSON.parse(localStorage.getItem(KEYS.records)||'[]');
let allLocations=JSON.parse(localStorage.getItem(KEYS.locations)||'["BH","PV","BAMBOO HILL","HOME","WORK"]');
let rateMemory=JSON.parse(localStorage.getItem(KEYS.rates)||'{}');
let editingIndex=null;

/* ÂÖÉÁ¥†ÂºïÁî® */
const elDate = document.getElementById('date');
const elStart = document.getElementById('start');
const elEnd = document.getElementById('end');
const elOdo = document.getElementById('odo');
const elLocation = document.getElementById('location');
const elRate = document.getElementById('rate');
const elCost = document.getElementById('cost');
const elMainBtn = document.getElementById('main-btn');
const elCancelBtn = document.getElementById('cancel-btn');

/* ÈªòËÆ§Êó•Êúü‰ªäÂ§© */
elDate.value=new Date().toISOString().slice(0,10);

/* ==== Start / End / ODOÔºöÊï∞Â≠óÈîÆÁõò + Ëá™Âä®Ë∑≥ ==== */
elStart.addEventListener('input', () => {
  let v = elStart.value.replace(/[^0-9]/g,'');
  if(v.length>3) v = v.slice(0,3);
  if(v === '00') v = '100';
  elStart.value = v;
  if(v.length >= 2){ // ËæìÂÖ•‰∏§‰ΩçÊï∞Ëá™Âä®Ë∑≥
    elEnd.focus();
  }
});

elEnd.addEventListener('input', () => {
  let v = elEnd.value.replace(/[^0-9]/g,'');
  if(v.length>3) v = v.slice(0,3);
  if(v === '00') v = '100';
  elEnd.value = v;
  if(v.length >= 2){
    elOdo.focus();
  }
});

elOdo.addEventListener('input', () => {
  let v = elOdo.value.replace(/[^0-9]/g,'');
  elOdo.value = v;
});

/* Rate / CostÔºödecimal ÈîÆÁõò + Âè™ÂÖÅËÆ∏‰∏Ä‰∏™ "." */
function sanitizeDecimalInput(el){
  let v = el.value.replace(/[^0-9.]/g,'');
  const parts = v.split('.');
  if(parts.length > 2){
    v = parts[0] + '.' + parts.slice(1).join('');
  }
  el.value = v;
}
elRate.addEventListener('input', () => sanitizeDecimalInput(elRate));
elCost.addEventListener('input', () => sanitizeDecimalInput(elCost));

/* Rate Âø´Êç∑ÊåâÈíÆ */
function setRate(v){
  if(v===0){
    elRate.value="";
    elRate.placeholder="Free / 0";
  }else{
    elRate.value=v;
  }
}

/* ======== LOCATION DROPDOWN ======== */
function renderLocations(){
  elLocation.innerHTML=`
    <option value="">Select Location</option>
    <option value="__ADD__">+ Add New Location</option>
    <option data-divider></option>
  `;
  allLocations.sort().forEach(loc=>{
    const o=document.createElement('option');
    o.value=loc;
    o.textContent=loc;
    elLocation.appendChild(o);
  });
}

elLocation.onchange=function(){
  if(this.value==="__ADD__"){ addLocationManually(); return; }
  if(rateMemory[this.value]!=null) elRate.value=rateMemory[this.value];
};

/* Add Location */
function addLocationManually(){
  const name=prompt("Enter new location:");
  if(!name)return;
  const up=name.trim().toUpperCase();
  if(!allLocations.includes(up)) allLocations.push(up);
  saveAll();
  renderLocations();
  renderLocationList();
}

/* Edit/Delete Location */
function editLocationName(oldName){
  const name=prompt("Rename:",oldName);
  if(!name)return;
  const up=name.trim().toUpperCase();
  if(up===oldName)return;

  allLocations=allLocations.map(l=>l===oldName?up:l);
  records.forEach(r=>{ if(r.location===oldName) r.location=up; });

  if(rateMemory[oldName]!=null){
    rateMemory[up]=rateMemory[oldName];
    delete rateMemory[oldName];
  }

  saveAll();
  renderLocations();
  renderLocationList();
  recomputeDriveStats();
  renderTable();
  renderMonthlySummary();
}
function deleteLocationName(l){
  if(!confirm("Remove this location? Records stay."))return;
  allLocations=allLocations.filter(x=>x!==l);
  delete rateMemory[l];
  saveAll();
  renderLocations();
  renderLocationList();
}

/* Location list UI */
function renderLocationList(){
  const box=document.getElementById('loc-list');
  box.innerHTML="";
  if(!allLocations.length){
    box.innerHTML='<div class="empty-row">No saved locations</div>';
    return;
  }
  allLocations.sort().forEach(loc=>{
    box.innerHTML += `
      <div class="loc-row">
        <div class="loc-name">${loc}</div>
        <div class="loc-actions">
          <span onclick="editLocationName('${loc}')">‚úèÔ∏è</span>
          <span onclick="deleteLocationName('${loc}')">üóë</span>
        </div>
      </div>`;
  });
}

/* Â∑•ÂÖ∑ÔºöÊó•ÊúüÊòæÁ§∫ */
function formatDateDisplay(str){
  const d=new Date(str);
  if(isNaN(d)) return str;
  return `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
}

/* Â∑•ÂÖ∑ÔºöÈáçÁÆóË°åÈ©∂ÈáåÁ®ã & Áî®Áîµ & Wh/km
   - Áî®Ôºö‰∏ä‰∏ÄÊù°ËÆ∞ÂΩïÁöÑ End% Âíå ODOÔºåÂíåÂΩìÂâçËÆ∞ÂΩïÁöÑ Start% Âíå ODO
   - ÁªìÊûúÂÜôÂú®ÂΩìÂâçËÆ∞ÂΩïÔºödriveKm / usedKwh / whPerKm
*/
function recomputeDriveStats(){
  if(!records.length) return;
  // ÊåâÊó•Êúü + ÂéüÈ°∫Â∫è Êéí
  const withIndex = records.map((r,i)=>({r,i}));
  withIndex.sort((a,b)=>{
    const da = a.r.date || '';
    const db = b.r.date || '';
    if(da===db) return a.i - b.i;
    return da.localeCompare(db);
  });

  let prev = null;
  withIndex.forEach(w=>{
    const rec = w.r;
    rec.driveKm = null;
    rec.usedKwh = null;
    rec.whPerKm = null;
    if(prev){
      const prevRec = prev.r;
      const odoPrev = Number(prevRec.odo||0);
      const odoCur  = Number(rec.odo||0);
      const endPrev = Number(prevRec.end||0);
      const startCur= Number(rec.start||0);

      const km = odoCur - odoPrev;
      const pctDrop = endPrev - startCur;
      let used = null;
      if(km>0 && pctDrop>0 && BATTERY_KWH>0){
        used = BATTERY_KWH * pctDrop / 100;
        const whPerKm = used * 1000 / km;
        rec.driveKm = km;
        rec.usedKwh = used;
        rec.whPerKm = whPerKm;
      }
    }
    prev = w;
  });
}

/* ‰øùÂ≠òÂà∞ localStorage */
function saveAll(){
  localStorage.setItem(KEYS.records,JSON.stringify(records));
  localStorage.setItem(KEYS.locations,JSON.stringify(allLocations));
  localStorage.setItem(KEYS.rates,JSON.stringify(rateMemory));
}

/* Monthly summaryÔºöÁî® usedKwh + driveKm */
function computeMonthlySummary(){
  const map={};
  records.forEach(r=>{
    if(!r.date || !r.usedKwh || !r.driveKm) return;
    const d=new Date(r.date);
    if(isNaN(d))return;
    const key=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    if(!map[key]) map[key]={year:d.getFullYear(),month:d.getMonth()+1,totalCost:0,totalKwh:0,totalKm:0};
    map[key].totalCost += Number(r.cost||0);
    map[key].totalKwh += Number(r.usedKwh||0);
    map[key].totalKm   += Number(r.driveKm||0);
  });
  return Object.values(map).sort((a,b)=>{
    if(a.year!==b.year) return b.year-a.year;
    return b.month-a.month;
  });
}

function renderMonthlySummary(){
  const box=document.getElementById('month-summary');
  box.innerHTML="";
  if(!records.length){
    box.innerHTML='<div class="empty-row">No data yet</div>';
    return;
  }
  const list = computeMonthlySummary();
  if(!list.length){
    box.innerHTML='<div class="empty-row">No drive data yet</div>';
    return;
  }
  list.forEach(m=>{
    const avgWh = (m.totalKwh>0 && m.totalKm>0) ? (m.totalKwh*1000/m.totalKm) : 0;
    box.innerHTML += `
      <div class="summary-row">
        <div class="summary-month">${String(m.month).padStart(2,'0')}/${m.year}</div>
        <div class="summary-values">
          <div>RM ${m.totalCost.toFixed(2)}</div>
          <div>${m.totalKwh.toFixed(2)} kWh ¬∑ ${avgWh?avgWh.toFixed(0):'-'} Wh/km ¬∑ ${m.totalKm.toFixed(0)} km</div>
        </div>
      </div>`;
  });
}

/* Ë°®Ê†ºÔºàÊúÄÊñ∞Âú®ÊúÄ‰∏äÔºâ */
function renderTable(){
  const tbody=document.getElementById('tableBody');
  tbody.innerHTML="";
  if(!records.length){
    tbody.innerHTML=`<tr><td colspan="9" class="empty-row">No records yet</td></tr>`;
    return;
  }

  const sorted = records
    .map((r,i)=>({r,i}))
    .sort((a,b)=>(b.r.date||'').localeCompare(a.r.date||'') || (b.i-a.i));

  sorted.forEach(({r,i})=>{
    const used = r.usedKwh ? r.usedKwh.toFixed(2) : '';
    const km   = r.driveKm ? r.driveKm.toFixed(0) : '';
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${formatDateDisplay(r.date)}</td>
      <td>${r.start ?? ''}</td>
      <td>${r.end ?? ''}</td>
      <td>${used}</td>
      <td>${km}</td>
      <td>${r.location || ''}</td>
      <td>${r.rate ?? ''}</td>
      <td>${r.cost ?? ''}</td>
      <td>
        <span class="action" onclick="startEdit(${i})">‚úèÔ∏è</span>
        <span class="action" onclick="deleteRecord(${i})">üóë</span>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* ÁºñËæë */
function startEdit(i){
  const r=records[i];
  editingIndex=i;
  elDate.value = r.date || '';
  elStart.value= r.start ?? '';
  elEnd.value  = r.end   ?? '';
  elOdo.value  = r.odo   ?? '';
  elRate.value = r.rate  ?? '';
  elCost.value = r.cost  ?? '';
  renderLocations();
  elLocation.value = r.location || '';
  elMainBtn.textContent="Save Changes";
  elCancelBtn.style.display="block";
}

function cancelEdit(){
  editingIndex=null;
  elMainBtn.textContent="Add Record";
  elCancelBtn.style.display="none";
  elDate.value=new Date().toISOString().slice(0,10);
  elStart.value="";
  elEnd.value="";
  elOdo.value="";
  elLocation.value="";
  elRate.value="";
  elCost.value="";
}

/* Âà†Èô§ËÆ∞ÂΩï */
function deleteRecord(i){
  if(!confirm("Delete this record?"))return;
  records.splice(i,1);
  saveAll();
  recomputeDriveStats();
  renderTable();
  renderMonthlySummary();
}

/* Êñ∞Â¢û / ‰øùÂ≠òËÆ∞ÂΩï */
function submitForm(){
  if(!elDate.value || !elLocation.value || !elRate.value || !elCost.value){
    alert("Date, Location, Rate, Cost required");
    return;
  }
  const rec={
    date:elDate.value,
    start:Number(elStart.value||0),
    end:Number(elEnd.value||0),
    odo:Number(elOdo.value||0),
    location:elLocation.value.toUpperCase(),
    rate:parseFloat(elRate.value||0),
    cost:parseFloat(elCost.value||0),
    driveKm:null,
    usedKwh:null,
    whPerKm:null
  };

  rateMemory[rec.location]=rec.rate;

  if(editingIndex===null) records.push(rec);
  else records[editingIndex]=rec;

  saveAll();
  recomputeDriveStats();
  cancelEdit();
  renderTable();
  renderLocationList();
  renderMonthlySummary();
}

/* Export CSVÔºàÂ∏¶ ODO ÂíåËÆ°ÁÆóÂ≠óÊÆµÔºâ */
function exportAll(){
  if(!records.length){
    alert("No data to export.");
    return;
  }
  let csv="date,start,end,odo,location,rate,cost,driveKm,usedKwh,whPerKm\n";
  records.forEach(r=>{
    csv+=`${r.date || ''},${r.start ?? ''},${r.end ?? ''},${r.odo ?? ''},"${(r.location||"").replace(/\"/g,'""')}",${r.rate ?? ''},${r.cost ?? ''},${r.driveKm ?? ''},${r.usedKwh ?? ''},${r.whPerKm ?? ''}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="ev_charge_backup.csv";
  a.click();
  URL.revokeObjectURL(url);
}

/* Ëß£Êûê CSVÔºàÂÖºÂÆπÊóßÁâàÔºåÊ≤°Êúâ ODO ‰πü‰∏ç‰ºöÊ≠ªÔºâ */
function parseCSV(text){
  const rows=text.split(/\r?\n/).filter(x=>x.trim());
  if(rows.length<=1) return [];
  const header=rows[0].toLowerCase().split(",");
  const idx={
    date:header.indexOf("date"),
    start:header.indexOf("start"),
    end:header.indexOf("end"),
    odo:header.indexOf("odo"),
    loc:header.indexOf("location"),
    rate:header.indexOf("rate"),
    cost:header.indexOf("cost"),
    driveKm:header.indexOf("drivekm"),
    usedKwh:header.indexOf("usedkwh"),
    whPerKm:header.indexOf("whperkm")
  };
  const out=[];
  for(let i=1;i<rows.length;i++){
    const cols=rows[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)?.map(x=>x.replace(/^"|"$/g,""));
    if(!cols)continue;
    const r={
      date: idx.date>=0 ? cols[idx.date] : "",
      start:idx.start>=0 ? Number(cols[idx.start]||0):0,
      end:  idx.end>=0   ? Number(cols[idx.end]  ||0):0,
      odo:  idx.odo>=0   ? Number(cols[idx.odo]  ||0):0,
      location:idx.loc>=0 ? (cols[idx.loc]||"").toUpperCase():"",
      rate: idx.rate>=0 ? parseFloat(cols[idx.rate]||0):0,
      cost: idx.cost>=0 ? parseFloat(cols[idx.cost]||0):0,
      driveKm: idx.driveKm>=0 ? Number(cols[idx.driveKm]||0):null,
      usedKwh: idx.usedKwh>=0 ? Number(cols[idx.usedKwh]||0):null,
      whPerKm: idx.whPerKm>=0 ? Number(cols[idx.whPerKm]||0):null
    };
    out.push(r);
  }
  return out;
}

/* Import CSV */
function importAll(input){
  const file=input.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=e=>{
    const list=parseCSV(e.target.result);
    if(!list.length){
      alert("Invalid CSV");
      return;
    }
    const replace=confirm("Replace existing data?\nOK = Replace\nCancel = Append");
    if(replace) records=list;
    else records=[...records,...list];

    const set=new Set(allLocations);
    list.forEach(r=>r.location && set.add(r.location));
    allLocations=[...set];

    saveAll();
    recomputeDriveStats();
    renderLocations();
    renderLocationList();
    renderTable();
    renderMonthlySummary();
    alert("Import completed!");
  };
  reader.readAsText(file);
}

/* INIT */
(function(){
  renderLocations();
  renderLocationList();
  recomputeDriveStats();
  renderTable();
  renderMonthlySummary();
  const d=new Date();
  document.getElementById('version').textContent=
    `Version v4-ODO-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
})();
</script>

</body>
</html>
