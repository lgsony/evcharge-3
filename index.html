<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>EV Charge Log Pro</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root{--bg:#000;--card:#1c1c1e;--text:#fff;--tesla-red:#E31937;--gray:#333;--border:#2c2c2e;}
  body{margin:0;font-family:-apple-system,sans-serif;background:var(--bg);color:var(--text);
       padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);}
  .c{max-width:600px;margin:0 auto;padding:0 16px;padding-bottom:120px;}
  header{padding:24px 0 16px;text-align:center;font-size:34px;font-weight:800;color:var(--tesla-red);}
  .card{background:var(--card);border-radius:20px;overflow:hidden;margin:20px 0;
         box-shadow:0 4px 16px rgba(227,25,55,0.15);border:1px solid #2a2a2a;}
  .section{padding:20px 20px 24px;}
  .section:not(:last-child){border-bottom:1px solid var(--border);}
  input,select{
    width:100%;padding:17px 16px;margin:8px 0;background:#2c2c2e;border:none;
    border-radius:13px;color:white;font-size:17px;box-sizing:border-box;
  }
  .row{display:flex;gap:12px;align-items:center;}
  .row > div{flex:1;}
  .btn{
    background:linear-gradient(180deg,#ff2a47,#e31937);color:white;border:none;
    padding:18px;border-radius:16px;font-size:19px;font-weight:700;margin-top:16px;
    box-shadow:0 6px 20px rgba(227,25,55,0.4);
  }
  .quick-btns{display:flex;flex-wrap:wrap;gap:11px;margin:14px 0 6px;justify-content:center;}
  .qb{padding:11px 18px;background:var(--gray);color:white;border-radius:30px;font-size:16px;font-weight:600;}
</style>
</head>
<body>

<div class="c">
  <header>EV Charge Log Pro</header>

  <div class="card">
    <div class="section">
      <div class="row">
        <div><input type="date" id="date" value="2025-12-06"></div>
        <div><input type="number" id="start" placeholder="Start %" min="0" max="100"></div>
        <div><input type="number" id="end" placeholder="End %" min="0" max="100"></div>
      </div>
    </div>

    <div class="section">
      <select id="location">
        <option value="">Select Location</option>
        <option value="__ADD__">+ Add New Location</option>
        <option disabled>────────────────</option>
      </select>
    </div>

    <div class="section">
      <div class="quick-btns">
        <button class="qb" onclick="setRate(0.84)">0.84</button>
        <button class="qb" onclick="setRate(1.00)">1.00</button>
        <button class="qb" onclick="setRate(1.30)">1.30</button>
        <button class="qb" onclick="setRate(1.50)">1.50</button>
        <button class="qb" onclick="setRate(1.80)">1.80</button>
        <button class="qb" onclick="setRate(0)">Free</button>
      </div>
    </div>

    <div class="section">
      <div class="row">
        <input type="number" step="0.001" inputmode="decimal" id="rate" placeholder="Rate (RM/kWh)">
        <input type="number" step="0.01" inputmode="decimal" id="cost" placeholder="Cost (RM) 可不填">
      </div>
    </div>

    <div class="section">
      <button class="btn" onclick="addRecord()">Add Record</button>
    </div>
  </div>
</div>

<script>
const BATTERY_CAPACITY = 60;
const KEY_RECORDS = 'evRecords2025';
const KEY_LOCATIONS = 'evLocations2025';
const KEY_RATES = 'evRateMemory2025';

let records = JSON.parse(localStorage.getItem(KEY_RECORDS)||'[]');
let allLocations = JSON.parse(localStorage.getItem(KEY_LOCATIONS)||'["BH","PV","BAMBOO HILL","HOME","WORK"]');
let rateMemory = JSON.parse(localStorage.getItem(KEY_RATES)||'{}');

// 智能跳转（你上一条要的完美版）
let lastInputTime = 0;
function smartJump(input, nextId) {
  const now = Date.now();
  const diff = now - lastInputTime;
  lastInputTime = now;
  const val = input.value.trim();

  if (val.length === 1 && diff > 500) {
    setTimeout(() => document.getElementById(nextId)?.focus(),